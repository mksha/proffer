---
data:
  environments:
    ci:
      accountId: 385838
      getCredsUsing: iamRole
      iamRoleName: test-iam-role
    develop:
      accountId: 123457
      getCredsUsing: awsProfile
      awsProfileName: test-profile
    sandbox:
      accountId: 786456
      getCredsUsing: envVars
    nonProd:
      accountId: 435325
  commonRegions: &commonRegions
  - us-west-1
  - us-west-2

resources:
- name: Copy AMI To Commercial Account Regions
  type: aws-copyami
  config:
    source:
      environment: ci
      region: us-west-2
      amiFilters:
        image-id: ami-01b55974057720a43
        name: ubuntu-1804-cis-level1-shared-09-12-19
        tag:Purpose: Testing
        tag:Department: DevOps
    target:
      regions:
      - us-west-1
      - us-west-2
      addExtraTags:
        Purpose: testing
        Department: DevOps

- name: Share AMI With Other Accounts
  type: aws-shareami
  config:
    source:
      environment: ci
      region: us-west-2
      amiFilters:
        name: my-ami-new-one
        id: ami-12131313
    target:
      environmentRegionMapping:
        develop:
          regions:
          - us-east-1
          - us-east-2
          extraTags: {}
        sandbox:
          regions:
          - ap-south-west-1
          extraTags:
            home: {{ env "HOME" | default "default value" }}
      commonRegions: *commonRegions

